
{% extends 'base.html' %}
{% load static %}

{% block content %}

<link  rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>



<style type="text/css">  
#mapIndia1 { 
    margin: auto;
    height: 90vh; 
    width: 730px;
}
</style>
<script type="text/javascript" src="{% static 'webapp/js/states.js' %}"></script>
<script type="text/javascript">
  var states_geojson = [];
</script>

  <div class="row">
    <div class="col-12">
    <h3><br/>State & District-wise data of NGOs</h3>
  </div>
</div>


<div class="row">
<div class="col-4">
<div class="accordion" id="accordionExample">



  {% for key, value in all_data.items %}

  <script type="text/javascript">
  states_geojson.push({"type":"Feature", "properties":{"ngo_count":{{value.ngo_count}}, "population_reach": {{value.population_reach}}, "staff_count": {{value.staff_count}}, "ST_NM":"{{key}}"}, "geometry":{"type":"MultiPolygon","coordinates":states["{{key}}"]}});
</script>

    <div class="card">
      <div class="" id="heading{{forloop.counter}}">
        <h2 class="mb-0">
          <button class="btn" style="width: 100%;text-align: left;" type="button" data-toggle="collapse" data-target="#collapse{{forloop.counter}}" aria-expanded="true" aria-controls="collapse{{forloop.counter}}">

            <span class="btn-link"><b>{{key}}</b></span> <br/> 
            <b style="color:#333">Total NGOs</b>: {{value.ngo_count}} <br/>
            <b style="color:#333">Population reach</b>: {{value.population_reach}} &nbsp;&nbsp;&nbsp;&nbsp; 
            <b style="color:#333">Staff count</b>: {{value.staff_count}}
          </button>

        </h2>

      </div>

      <div id="collapse{{forloop.counter}}" class="collapse" aria-labelledby="heading{{forloop.counter}}" data-parent="#accordionExample" >
        <div class="card-body">
          <ul class="list-group mb-3">
            <li class="list-group-item"><a href="" class="btn-link"> See the list of ALL NGOs in {{key}} </a></li>
            {% for district in value.districts %}
            <li class="list-group-item">
                <b>{{district.0}}</b> <br/>
              Total NGOs: {{district.1}} <br/>
              Population reach: {{district.2}} &nbsp;&nbsp;&nbsp;&nbsp; 
              Staff count: {{district.3}} <br/>
              <a href="" class="btn-link"> See the list of NGOs in {{district.0}} </a>

            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  {% endfor %}

</div>
</div>
 
<div class="col-8">
  <div id="mapIndia1">
    </div>
</div>
</div>









<script>

var geojson;

function getStateColorByNGO(d) {
    return d > 100 ? '#800026' :
           d > 50  ? '#BD0026' :
           d > 20  ? '#E31A1C' :
           d > 10  ? '#FC4E2A' :
           d > 5   ? '#FD8D3C' :
           d > 2   ? '#FEB24C' :
           d > 1   ? '#FED976' :
                      '#FFEDA0';
}

function style_states1(feature) {
  return {
    fillColor: getStateColorByNGO(feature.properties.ngo_count),
      weight: 1,
      opacity: 1,
      color: 'grey',
      dashArray: '0',
      fillOpacity: 1
    };
}


function highlightFeature(e) {
    var layer = e.target;

    layer.setStyle({
        weight: 5,
        color: '#666',
        dashArray: '',
        fillOpacity: 0.7
    });

    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
        layer.bringToFront();
    }
}

function resetHighlight(e) {
    geojson.resetStyle(e.target);
}

function zoomToFeature(e) {
    map.fitBounds(e.target.getBounds());
}

function onEachFeature(feature, layer) {
  layer.bindPopup('<span class="btn-link"><b>'+ feature.properties.ST_NM + '</b></span> <br/> \
            <b style="color:#333">Total NGOs</b>:' + feature.properties.ngo_count + '<br/>\
            <b style="color:#333">Population reach</b>:' + feature.properties.population_reach + '&nbsp;&nbsp;&nbsp;&nbsp; \
            <b style="color:#333">Staff count</b>:'+ feature.properties.staff_count);


    layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight,
        // click: zoomToFeature
    });
}

var map = L.map('mapIndia1').setView([22.805, 82.0], 5);
// Blank Layer to get us started
var myLayer = L.geoJSON().addTo(map);

// Add States Layer
// geojson = L.geoJson(states_geojson, {
//     style: style_states1,
//     onEachFeature: function (feature, layer) {
//       layer.bindPopup('<h3>State: '+feature.properties.ST_NM+'</h3>');
//     }
//   }).addTo(map);

geojson = L.geoJson(states_geojson, {
    style: style_states1,
    onEachFeature: onEachFeature
  }).addTo(map);


// CODE FOR LEGEND

// var legend = L.control({position: 'bottomright'});
// legend.onAdd = function (map) {
//     var div = L.DomUtil.create('div', 'info legend'),
//         grades = [0, 10, 20, 50, 100, 200, 500, 1000],
//         labels = [];

//     // loop through our density intervals and generate a label with a colored square for each interval
//     for (var i = 0; i < grades.length; i++) {
//         div.innerHTML +=
//             '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
//             grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
//     }
//     return div;
// };

// legend.addTo(map);

// Add OSM tile layer with correct attribution
var osmUrl='https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
var osmAttrib='Map data © <a href="https://openstreetmap.org">OpenStreetMap</a> contributors';
var osm = new L.TileLayer(osmUrl, {minZoom: 3, maxZoom: 12, attribution: osmAttrib}); 
map.addLayer(osm);  

// Add Google tile layer with attribution
// L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
//     maxZoom: 20,
//     subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
//     }, attribution: 'Map data © <a href="https://maps.google.com">Google</a> contributors').addTo(map); 
</script>

{% endblock %}